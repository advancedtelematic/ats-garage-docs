---
layout: page
title: "Getting started: Your first OSTree-enabled Yocto project"
category: ostree
order: 2
date: 2016-12-20 17:20:24
---
:icons: font

To help new users get running with Yocto, we've created a quick-start project for the Raspberry Pi. In this tutorial, we'll show you:

* How to build your first Yocto image and get it running on a Raspberry Pi,
* How to automatically push that image to your ATS Garage account, and
* How to install the image on your Pi and get it talking to ATS Garage

== Prerequisites

* A linux machine with at least 50 GB of hard drive space
* A link:https://www.raspberrypi.org/products/raspberry-pi-3-model-b/[Raspberry Pi 3]
* A micro SD card, 1 GB or larger
* An ATS Garage account with TreeHub enabled
* Your TreeHub credentials file (downloadable from the TreeHub tab in ATS Garage)

== Building your first Yocto image

Yocto is a set of tools for building your own linux distribution, from source. It's already the most common standard for commercial and industrial embedded systems, but it's also a great choice for dedicated hacking projects, because you can build in only what you need. The image you'll be building for this project, in fact, weighs in at just over 100 MB and boots in just a few seconds.

=== 1. Clone the ATS Garage Quickstart repo and set up your build environment

The link:https://github.com/advancedtelematic/garage-quickstart-rpi[garage-quickstart-rpi] project contains everything you need to get started. It uses git submodules, so make sure to use the `--recursive` option when you clone it:

----
git clone --recursive https://github.com/advancedtelematic/garage-quickstart-rpi.git
----

Then, enter the garage-quickstart-rpi directory and run the build setup script:

----
cd garage-quickstart-rpi
source env-init.sh
----

=== 2. Add your Treehub credentials to the build

The `meta-updater` layer will automatically push your images to TreeHub and add them to your ATS Garage account as part of the build process. To do that, it needs the credentials file you downloaded. (If you haven't downloaded it yet, grab it now from the link:https://app.atsgarage.com/#/treehub[TreeHub tab].)

Add the following line to `garage-quickstart-rpi/build/conf/local.conf`:

----
OSTREE_PUSH_CREDENTIALS = "path/to/credentials_file"
----

=== 3. Build your image

This part's easy. From the build directory, run

----
bitbake core-image-minimal
----

...and then go do something fun for a while.

link:http://xkcd.com/303/[image:http://imgs.xkcd.com/comics/compiling.png[]]

Yocto downloads source code, and builds absolutely everything from source. Naturally, this takes quite a while--anywhere from 45 minutes on a fast i7 to 2-3 hours or more on a slower system. Fortunately, Yocto does cache everything, so on subsequent builds you only need to recompile the pieces you've actually changed, which means everything goes much, much faster.

=== 4. Flash the image onto your micro SD card

----
sudo dd if=./tmp/deploy/images/raspberrypi3/core-image-minimal-raspberrypi3.rpi-sdimg-ota of=/dev/sdX bs=32M && sync
sudo parted -s /dev/sdX resizepart 2 '100%'
sudo resize2fs /dev/sdX2
----

=== 5. Add your device credentials to the SD card

. Create a new device in ATS Garage.
. Download its credentials, selecting OSTree as the package manager.
. Copy this file onto your SD card, placing it in `/boot/sota.toml` on partition 2. (It needs to be in exactly this location.)

== link:/ostree/making-your-first-ostree-update.html[Next: Pushing your first update >>]

