= Provisioning methods and credentials.zip
:page-layout: page
:page-categories: [concepts]
:page-date: 2018-03-15 16:15:17
:page-order: 99
:icons: font

If you're trying to work on integrating {product-name} into your device build, it may be helpful to have a little bit of reference information on how the different provisioning methods work together, and what exactly the magic sauce inside `credentials.zip` is.

== `credentials.zip` file format

First, a table:

// formerly: include::https://raw.githubusercontent.com/advancedtelematic/aktualizr/master/docs/credentials.adoc[tag="credentials-table"]. Temporarily duping content untik Antora migration is done

[options="header"]
|======================
| Filename in zip | Purpose | Used by
| treehub.json | Location and authentications for treehub and Uptane repo | garage-sign, garage-push
| client.crt | Certificate for TLS client authentication | garage-push
| client.key | Private key for TLS client authentication | garage-push
| root.crt | Root CA for TLS client authentication | garage-push
| autoprov_credentials.p12 | TLS client credentials that are required when provisioning devices with shared credentials | aktualizr, aktualizr-cert-provider
| autoprov.url | URL for provisioning server | aktualizr, aktualizr-cert-provider
| root.json | Initial Uptane root.json (for secure bootstrapping) | garage-sign
| targets.pub | Public key for offline Uptane image signing | garage-sign
| targets.sec | Private key for offline Uptane image signing | garage-sign
| tufrepo.url | URL to Uptane repository | garage-sign
|======================

As you can see, the relevant files for the device itself are `autoprov_credentials.p12` and `autoprov.url`.

When you link:../prod/enable-implicit-provisioning.html#use-a-hardware-security-module-hsm-when-provisioning-with-device-credentials[provision with Device Credentials via an HSM], the `implicit_writer` function in meta-updater takes over. The initial credentials on the device won't be valid; this is why you need to copy in the generated ones after booting it.

== Configuration options for provisioning with device credentials

When provisioning with device credentials, OTA Connect needs to get various certificates and keys from somewhere. The following table summarizes what is needed, and where it comes from in the HSM.

// formerly: include::https://raw.githubusercontent.com/advancedtelematic/aktualizr/master/docs/hsm-provisioning.adoc[tag="summary-table"]. Temporarily duping content untik Antora migration is done

[options=header]
|===================
| Configuration option         | Where it will come from/what it does
| Server URL                   | Read from credentials archive
| Server Root CA cert          | Read from credentials archive
| Fleet Root CA cert           | Chain of trust for a device fleet; provided by the user. Must be uploaded by user to the server.
| Fleet Root CA private key    | Key for signing device certs in the fleet; provided by user, but used only for signing. Not stored on device.
| TLS device cert              | Pre-installed in the device HSM; must be signed by Fleet Root CA private key
| TLS device key               | Pre-installed in the device HSM
| Device ID                    | Read from Common Name field of TLS device cert
| Uptane public/private key    | Automatically generated by Aktualizr
| Uptane primary serial number | Automatically generated by Aktualizr
| Primary ECU Hardware ID      | Automatically generated by Aktualizr
|===================


NOTE: The "Fleet Root CA" is the one generated in step 1 of the link:../prod/enable-implicit-provisioning.html#use-a-hardware-security-module-hsm-when-provisioning-with-device-credentials[use a Hardware Security Module to provision with device credentials]. instructions.